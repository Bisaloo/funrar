---
title: "Use `outlieR` to compute Functional Rarity indices"
author: "Matthias Greni\u00e9"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Use `outlieR` to compute Functional Rarity Indices}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

The idea of Functional Rarity is to measure two components of the rarity of a species (or an individual). Indeed, in community ecology, people are generally interested in the rarity of a species in terms of abundances. A species with a low abundance will be considered as rare. From a Functional Ecology perspective, this does not take into consideration the "role" that a given species plays in the ecosystem, its particular niche. A framework is being developed of various indices to characterize how this function could be rare locally or regionally.


## Distance Matrix

The indices rely on the computation of a distance matrix. It represents the functional distance between two species given a particular set of traits. From a species traits matrix you can easily compute a distance matrix using function `compute_dist_matrix()`:

```{r distanceMatrix}
library(outlieR)
# Species X Traits table
traits = data.frame(tr1 = 1:10, tr2 = rep(c(1, 0), each = 5), tr3 = rep(LETTERS[1:5], 2))

rownames(traits) = paste0("sp", 1:10)

# Distance Matrix
dist_mat = compute_dist_matrix(traits)

dist_mat[1:5, 1:5]
```


In order to compute distance matrix, species names must be specified as **rownames** in the traits table. And they will be named similarly in the distance matrix. Species names must be characters and not factors.

The function relies on the `daisy()` function from package `cluster` and the default metric is Gower's distance to take into account ordinal, categorical and binary traits.



## Distinctiveness

### Formula

The distinctiveness measure how a species is locally functionally rare. From given functional distances, it is computed as such:

$$
D_i = \frac{\sum_{\substack{j = 1, \\
                            i \neq j
                            }}^{N} d_{ij}}{N-1},
$$

with $D_i$ distinctiveness of species $i$, $d_{ij}$ the functional distance between species $i$ and species $j$, $N$ the number of species present in considered community.

When weighted by abundances the formula becomes:

$$
D_i = \frac{\sum_{\substack{j = 1, \\
                            i \neq j
                            }}^{N} d_{ij}\times A_j}{\sum_{\substack{j = 1, \\
                            i \neq j
                            }}^{N} A_j},
$$
with the same terms as above, and $A_j$ the relative abundance of species $j$ in percent, in the community.


### Computation

Using `outlieR` distinctiveness values can be computed using function `distinctiveness()`:

```{r distinctivenessComputation}
# Species X Site Table
species_list = rownames(traits)

site_species = data.frame(species = c(species_list[-1],
                                      species_list[seq(1, 9, 2)],
                                      species_list[seq(2, 10, 2)]),
                          site = c(rep("com1", 9),
                                   rep(c("com2", "com3"), each = 5)))

# Species should be character
site_species$species = as.character(site_species$species)

# Compute distinctiveness for each species on each site
site_dist = distinctiveness(com_table = site_species,  # The site x species table
                            sp_col = "species",  # Name of the species column
                            com = "site",  # Name of the community column
                            abund = NULL,  # Relative abundances column (facultative)
                            dist_matrix = dist_mat)  # Functional Distance matrix

head(site_dist)
```

The syntax for `distinctiveness()` is first the table, then the name of the species column, then the name of the community column, then eventually the name of the relative abundance column and finally the distance matrix. The function add a `Di` column giving the species distinctiveness in each species per site combination.

For abundance weighted distinctiveness you need to have a column containing relative abundances in your data frame as such:

```{r abundDist}
set.seed(1)  # For reproducibility

# Generates vector that sums up to 1
com1 = runif(9)
com2 = runif(5)
com3 = runif(5)
site_species$abund = c(com1/sum(com1), com2/sum(com2), com3/sum(com3)) 

data_di = distinctiveness(site_species, "species", "site", "abund", dist_mat)
head(data_di)
```




## Sparseness

### Formula

$$
S_i = \exp(-NA_i\log2),
$$

with $S_i$ the sparseness of species $i$, $N$ the number of species in the local community, $A_i$ the relative abundance (in percent) of species $i$ in the community.


### Computation

With `outlieR` it can be computed with `sparseness()` function with a syntax analog to `distinctiveness()`

```{r sparsenessComp}
sparseness(site_species, "species", "site", "abund")
```




## Uniqueness

### Formula

$$
U_i = \text{min}(d_{ij}), \forall j \in [1, N_R], j \neq i,
$$

with $U_i$ the uniqueness of species $i$, $d_{ij}$ the functional distance between species $i$ and species $j$, $N_R$ the number of species in the regional pool.

### Computation

`uniqueness()` follows a similar syntax, but beware that given community table and distance matrix should be given out of **regional species pool**. And the syntax is also similar:

```{r uniqComp}
site_ui = uniqueness(site_species, "species", dist_mat)
head(ui)
```

