<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Alternative Distinctiveness definition • funrar</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Alternative Distinctiveness definition">
<meta property="og:description" content="funrar">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">funrar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.4.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/new_distinctiveness.html">Alternative Distinctiveness definition</a>
    </li>
    <li>
      <a href="../articles/rarity_indices.html">How to use `funrar`, an example with plant communities dataset.</a>
    </li>
    <li>
      <a href="../articles/sparse_matrices.html">Sparse Matrices with `funrar`</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Rekyt/funrar/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Alternative Distinctiveness definition</h1>
                        <h4 class="author">Matthias Grenié</h4>
            
            <h4 class="date">2020-04-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Rekyt/funrar/blob/master/vignettes/new_distinctiveness.Rmd"><code>vignettes/new_distinctiveness.Rmd</code></a></small>
      <div class="hidden name"><code>new_distinctiveness.Rmd</code></div>

    </div>

    
    
<p>The current definition of functional distinctiveness standardizes compared to all the species considered in the species pool. However, especially when investigating on trait competition and hierarchy, it can be important to scale this distinctiveness relatively to the species present in the community.</p>
<div id="presence-absence" class="section level2">
<h2 class="hasAnchor">
<a href="#presence-absence" class="anchor"></a>Presence-Absence</h2>
<p>Thus an alternative definition of functional distinctiveness can be given, scaled relatively to a given trait range considered (what matters for species are the species within this trait range, not beyond). Our new distinctiveness measure is <span class="math inline">\(D_i(T)\)</span>, with <span class="math inline">\(T\)</span> the trait range to consider.</p>
<p>We can imagine three species in a given community positioned on a trait axis:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">species_df</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">species</span> <span class="kw">=</span>     <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>),
  <span class="kw">trait_value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0.5</span>)
)

<span class="no">species_distance</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">a</span> <span class="kw">=</span> -<span class="fl">1</span>, <span class="kw">b</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">c</span> <span class="kw">=</span> <span class="fl">0.5</span>))

<span class="no">species_distance</span></pre></body></html></div>
<pre><code>##     a   b
## b 1.0    
## c 1.5 0.5</code></pre>
<p>Species <span class="math inline">\(b\)</span> is closer to species <span class="math inline">\(c\)</span> than to species <span class="math inline">\(a\)</span>. The greatest distance is observed between species <span class="math inline">\(a\)</span> and species <span class="math inline">\(c\)</span>.</p>
<p><span class="math inline">\(T\)</span> can value from 0 to the maximum observed functional distance among considered species.</p>
<div id="theoretical-definition" class="section level3">
<h3 class="hasAnchor">
<a href="#theoretical-definition" class="anchor"></a>Theoretical definition</h3>
<p>The proposed formula for <span class="math inline">\(D_i(T)\)</span> is:</p>
<p><span class="math display">\[
D_{i} (T) = 
  \begin{dcases}
    1 &amp; if~~T &lt; \text{min}(d_{ij}) \quad \text{(trait range smaller than distance to closest neighbor)}\\
    \frac{\sum\limits_{
          \substack{
                j = 1 \\
                j \neq i \\
                d_{ij} \leq T}}^S d_{ij}}{
          \sum\limits_{\substack{
                j = 1 \\
                j \neq i \\
                d_{ij} \leq T}}^S 1}
                 &amp; if~~T \geq \text{min}(d_{ij}) \quad (\text{there is one or more species close to focal species within range of T})
  \end{dcases} 
\]</span> This would given the following formula for the distinctiveness of species <span class="math inline">\(b\)</span>, in the community with species <span class="math inline">\(a\)</span> and <span class="math inline">\(c\)</span>:</p>
<p><span class="math display">\[
D_b(T) =
  \begin{dcases}
    1                         &amp; if ~~ T &lt; d_{bc} = 0.5 \\
    d_{bc}                    &amp; if ~~ d_{bc} = 0.5 \leq T &lt; d_{ba} = 1 \\
    \frac{d_{bc} + d_{ba}}{2} &amp; if ~~ T \geq d_{ba} = 1 
  \end{dcases}
\]</span></p>
</div>
<div id="implementation" class="section level3">
<h3 class="hasAnchor">
<a href="#implementation" class="anchor"></a>Implementation</h3>
<p>Implementing this version of distinctiveness would give:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">alternative_distinctiveness</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">pres_mat</span>, <span class="no">distance_obj</span>, <span class="no">given_T</span>) {
  <span class="no">dist_mat</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">distance_obj</span>)

  <span class="no">kept_sp</span> <span class="kw">=</span> <span class="kw pkg">funrar</span><span class="kw ns">:::</span><span class="fu">species_in_common</span>(<span class="no">pres_mat</span>, <span class="no">dist_mat</span>)
  <span class="no">dist_mat</span> <span class="kw">=</span> <span class="no">dist_mat</span>[<span class="no">kept_sp</span>, <span class="no">kept_sp</span>, <span class="kw">drop</span> <span class="kw">=</span> <span class="fl">FALSE</span>]


  <span class="co"># Correspondence matrix (tracking which species we want to keep)</span>
  <span class="no">corr_dist</span> <span class="kw">=</span> <span class="no">dist_mat</span>
  <span class="no">corr_dist</span>[<span class="no">dist_mat</span> <span class="kw">&gt;</span> <span class="no">given_T</span>] <span class="kw">=</span> <span class="fl">0</span>
  <span class="no">corr_dist</span>[<span class="no">dist_mat</span> <span class="kw">&lt;=</span> <span class="no">given_T</span>] <span class="kw">=</span> <span class="fl">1</span>
  <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="no">corr_dist</span>) <span class="kw">=</span> <span class="fl">0</span>

  <span class="co"># Across sites</span>
  <span class="co"># given_pres is a vector of presences per site</span>
  <span class="no">di_mat</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">pres_mat</span>, <span class="fl">1</span>, <span class="kw">function</span>(<span class="no">given_pres</span>) {
    <span class="no">index_mat</span> <span class="kw">=</span> <span class="no">given_pres</span> <span class="kw">%*%</span> (<span class="no">dist_mat</span> * <span class="no">corr_dist</span>)  <span class="co"># Sum of distances per species</span>
    <span class="no">denom_mat</span> <span class="kw">=</span> <span class="no">given_pres</span> <span class="kw">%*%</span> <span class="no">corr_dist</span>  <span class="co"># Number of distances considered per species</span>
    <span class="no">index_mat</span> <span class="kw">=</span> <span class="no">index_mat</span> / <span class="no">denom_mat</span>
    <span class="no">index_mat</span>[<span class="no">given_pres</span> <span class="kw">==</span> <span class="fl">0</span>] <span class="kw">=</span> <span class="fl">NA</span>
    <span class="no">index_mat</span>[<span class="fu"><a href="https://rdrr.io/r/base/is.finite.html">is.nan</a></span>(<span class="no">index_mat</span>)] <span class="kw">=</span> <span class="fl">1</span>

    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">index_mat</span>)
  })

  <span class="no">di_mat</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">di_mat</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(<span class="no">di_mat</span>) <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(<span class="no">pres_mat</span>)

  <span class="no">di_df</span> <span class="kw">=</span> <span class="kw pkg">funrar</span><span class="kw ns">::</span><span class="fu"><a href="../reference/matrix_to_stack.html">matrix_to_stack</a></span>(<span class="no">di_mat</span>, <span class="st">"Di"</span>)
  <span class="no">di_df</span>$<span class="no">given_range</span> <span class="kw">=</span> <span class="no">given_T</span>

  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">di_df</span>)
}</pre></body></html></div>
<p>Here we truncate the distance matrix in order to “nullify” the effect of species that are not in specified range.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">presence_matrix</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>, <span class="fl">3</span>), <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>), <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">3</span>,
                         <span class="kw">dimnames</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">site</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"s1"</span>, <span class="st">"s2"</span>, <span class="st">"s3"</span>),
                                         <span class="kw">species</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>)))

<span class="co"># Test over a ragne of possible T values</span>
<span class="no">all_T</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">50</span>),
       <span class="kw">function</span>(<span class="no">given_number</span>)  <span class="fu">alternative_distinctiveness</span>(
         <span class="no">presence_matrix</span>,
         <span class="no">species_distance</span>,
         <span class="no">given_number</span>))

<span class="no">all_T</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="no">rbind.data.frame</span>, <span class="no">all_T</span>)</pre></body></html></div>
<p>We can visualize those relationships:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">all_T</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">given_range</span>, <span class="no">Di</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">species</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">1</span>/<span class="fl">2</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(~<span class="no">site</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Fixed distance range"</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Functional Distinctiveness"</span>,
       <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Species"</span>)</pre></body></html></div>
<p><img src="new_distinctiveness_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div id="using-real-data" class="section level3">
<h3 class="hasAnchor">
<a href="#using-real-data" class="anchor"></a>Using real data</h3>
<p>We’ll be using the dataset <code>aravo</code> from the <code>ade4</code> package.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"funrar"</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"aravo"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"ade4"</span>)
<span class="co"># Site-species matrix</span>
<span class="no">mat</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">aravo</span>$<span class="no">spe</span>)

<span class="co"># Convert matrix to presence-absence matrix</span>
<span class="no">mat</span>[<span class="no">mat</span> <span class="kw">&gt;</span> <span class="fl">0</span>] <span class="kw">=</span> <span class="fl">1</span>

<span class="co"># Example of trait table</span>
<span class="no">tra</span> <span class="kw">=</span> <span class="no">aravo</span>$<span class="no">traits</span>[, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Height"</span>, <span class="st">"SLA"</span>, <span class="st">"N_mass"</span>)]
<span class="co"># Distance matrix</span>
<span class="no">dist_mat</span> <span class="kw">=</span> <span class="fu"><a href="../reference/compute_dist_matrix.html">compute_dist_matrix</a></span>(<span class="no">tra</span>, <span class="kw">metric</span> <span class="kw">=</span> <span class="st">"gower"</span>)</pre></body></html></div>
<pre><code>## Warning in compute_dist_matrix(tra, metric = "gower"): Only numeric traits
## provided, consider using euclidean distance.</code></pre>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">dist_mat</span> <span class="kw">=</span> (<span class="no">dist_mat</span> - <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">dist_mat</span>))/<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="no">dist_mat</span>))

<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(<span class="no">mat</span>)) <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"site"</span>, <span class="st">"species"</span>)

<span class="co"># Compute different values of distinctiveness using various ranges</span>
<span class="no">all_ranges</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">1</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">50</span>), <span class="kw">function</span>(<span class="no">given_range</span>) {
  <span class="fu">alternative_distinctiveness</span>(<span class="no">mat</span>, <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span>(<span class="no">dist_mat</span>), <span class="no">given_range</span>)
})

<span class="no">all_ranges</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="no">rbind.data.frame</span>, <span class="no">all_ranges</span>)</pre></body></html></div>
<p>Now we can visualize the influence of the trait range value</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">all_ranges</span>, <span class="no">site</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AR07"</span>, <span class="st">"AR51"</span>, <span class="st">"AR02"</span>)),
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">given_range</span>, <span class="no">Di</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">species</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">1</span>/<span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~<span class="no">site</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Maximum Distance Range Considered\n(Trait Range)"</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Functional Distinctiveness"</span>)</pre></body></html></div>
<p><img src="new_distinctiveness_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>We see that species have close neighbors at different distances (leap from top left to bottom left of the graph). This shows the closet neighbors for each species.</p>
<p>As proposed we can also distinctiveness relative to trait range and see what it changes:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">all_ranges</span>$<span class="no">scaled_Di</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(
  <span class="no">all_ranges</span>$<span class="no">Di</span> <span class="kw">!=</span> <span class="fl">1</span>,
  <span class="no">all_ranges</span>$<span class="no">Di</span> / <span class="no">all_ranges</span>$<span class="no">given_range</span>,
  <span class="no">all_ranges</span>$<span class="no">Di</span>)

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">all_ranges</span>, <span class="no">site</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AR07"</span>, <span class="st">"AR51"</span>, <span class="st">"AR02"</span>)),
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">given_range</span>, <span class="no">scaled_Di</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">species</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">1</span>/<span class="fl">4</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~<span class="no">site</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Considered Trait Range\n(Functional Distance)"</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Scaled Functional Distinctiveness\n(over trait range)"</span>)</pre></body></html></div>
<p><img src="new_distinctiveness_files/figure-html/scaled_range-1.png" width="700"></p>
<p>This reflects the relative (in terms of trait range considered) distinctiveness. Meaning that close species in a small range have similar distinctiveness than further apart species in larger ranges.</p>
</div>
</div>
<div id="considering-abundance" class="section level2">
<h2 class="hasAnchor">
<a href="#considering-abundance" class="anchor"></a>Considering Abundance</h2>
<p>Now that we have a version with presence and absences we can try to think about a alternative version of distinctiveness using abundances.</p>
<p>We need the index to behave the following way: an rare species in trait range should be more distinct than a common species in that range. A species close to a rare species in a trait range but far from a common species should be more distinct than a species close to a common species and far away from a rare one.</p>
<p>The current definition of functional distinctiveness with relative abundances is:</p>
<p><span class="math display">\[
\tilde{D_i} = \frac{
  \sum\limits_{
      \substack{j = 1 \\
                j \neq i}}^S d_{ij}
  \times Ab_j}{
  \sum\limits_{
      \substack{j = 1 \\
                j \neq i}}^S
  Ab_j}
\]</span> with <span class="math inline">\(Ab_j\)</span> the relative abundance of species <span class="math inline">\(j\)</span> in given community.</p>
<div id="theoretical-definition-1" class="section level3">
<h3 class="hasAnchor">
<a href="#theoretical-definition-1" class="anchor"></a>Theoretical definition</h3>
<p>If we try to consider the constraints above we can write the index as follow</p>
<p><span class="math display">\[
D_i (T) =
  \begin{dcases}
  1 &amp; if ~~ T &lt; \text{min}(d_{ij})\\
  \left( \frac{
    \sum\limits_{
      \substack{j = 1 \\
                j \neq i \\
                d_{ij} \leq T}}^S d_{ij} \times Ab_j
  }{
    \sum\limits_{
      \substack{j = 1 \\
                j \neq i \\
                d_{ij} \leq T}}^S Ab_j
  } \right) \times \left(1 - \frac{
    \sum\limits_{
      \substack{j = 1 \\
                j \neq i \\
                d_{ij} \leq T}}^S Ab_j
  }{
    N
  } \right) &amp; if ~~ T \geq \text{min}(d_{ij})
  \end{dcases}
\]</span> with <span class="math inline">\(S\)</span> the number of species in the considered community, <span class="math inline">\(Ab_j\)</span> the relative abundance of species <span class="math inline">\(j\)</span> in the community and <span class="math inline">\(N\)</span> the total number of individual in the community.</p>
<p>The problem here is the term on the right: <span class="math display">\[\frac{ \sum\limits_{\substack{j = 1 \\
                j \neq i \\
                d_{ij} \leq T}}^S Ab_j
  }{
    N
  }
\]</span></p>
<p>As <span class="math inline">\(Ab_j = \frac{N_j}{N}\)</span> the term rather be: <span class="math display">\[
\sum\limits_{\substack{j = 1 \\
                       j \neq i \\
                       d_{ij} \leq T}}^S
  Ab_j\]</span></p>
<div id="definitive-formula" class="section level4">
<h4 class="hasAnchor">
<a href="#definitive-formula" class="anchor"></a>Definitive formula</h4>
<p>which gives the following definition in the end: <span class="math display">\[
D_i (T) =
  \begin{dcases}
  1 &amp; if ~~ T &lt; \text{min}(d_{ij})\\
  \left( \frac{
    \sum\limits_{
      \substack{j = 1 \\
                j \neq i \\
                d_{ij} \leq T}}^S d_{ij} \times Ab_j
  }{
    \sum\limits_{
      \substack{j = 1 \\
                j \neq i \\
                d_{ij} \leq T}}^S Ab_j
  } \right) \times \left(1 -
    \sum\limits_{
      \substack{j = 1 \\
                j \neq i \\
                d_{ij} \leq T}}^S Ab_j
   \right) &amp; if ~~ T \geq \text{min}(d_{ij})
  \end{dcases}
\]</span></p>
</div>
<div id="reconciling-with-presence-absence-definition" class="section level4">
<h4 class="hasAnchor">
<a href="#reconciling-with-presence-absence-definition" class="anchor"></a>Reconciling with presence-absence definition</h4>
<p>We can also check how this definition differs from the previous one by saying that <span class="math inline">\(Ab_j = \frac{1}{N}\)</span> and <span class="math inline">\(N = S\)</span> (one individual per species in each community) this gives us:</p>

<p>From  we find back the definition of <span class="math inline">\(D_i(T)\)</span> with presence and absences only. However there is an additional that resembles to a mean distance. It’s the sum of all the distances to species within range of the focal species over the total number of species in the community. This term depends on the number of species in the community.</p>
<p>From  we see that as the range comprises more species the term between parenthesis approaches zero and thus we observe a (near-)zero distinctiveness for all the species in the community whatever the functional distances between species.</p>
<p>In the end, this definition does not seem to reconcile well with the presence-absence definition.</p>
</div>
</div>
<div id="implementation-1" class="section level3">
<h3 class="hasAnchor">
<a href="#implementation-1" class="anchor"></a>Implementation</h3>
<p>Similar to the strategy we can implement this definition of functional distinctiveness by using a correspondence matrix in which we nullify the importance of species that are further away than the given threshold. In order to test the behavior of the metric we design an abundance matrix with the same species again a, b, and c:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">ab_mat</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>/<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">1</span>/<span class="fl">6</span>, <span class="fl">1</span>/<span class="fl">6</span>, <span class="fl">4</span>/<span class="fl">6</span>, <span class="fl">4</span>/<span class="fl">6</span>, <span class="fl">1</span>/<span class="fl">6</span>, <span class="fl">1</span>/<span class="fl">6</span>), <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">3</span>,
                         <span class="kw">dimnames</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">site</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"s1"</span>, <span class="st">"s2"</span>, <span class="st">"s3"</span>),
                                         <span class="kw">species</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>)),
                <span class="kw">byrow</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="no">alternative_distinctiveness_abundance</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">abund_mat</span>, <span class="no">dist_matrix</span>,
                                                 <span class="no">given_range</span>) {

  <span class="no">dist_mat</span> <span class="kw">=</span> <span class="no">dist_matrix</span>

  <span class="no">kept_sp</span> <span class="kw">=</span> <span class="kw pkg">funrar</span><span class="kw ns">:::</span><span class="fu">species_in_common</span>(<span class="no">abund_mat</span>, <span class="no">dist_mat</span>)
  <span class="no">dist_mat</span> <span class="kw">=</span> <span class="no">dist_mat</span>[<span class="no">kept_sp</span>, <span class="no">kept_sp</span>, <span class="kw">drop</span> <span class="kw">=</span> <span class="fl">FALSE</span>]


  <span class="co"># Correspondence matrix (tracking which species we want to keep)</span>
  <span class="no">corr_dist</span> <span class="kw">=</span> <span class="no">dist_mat</span>
  <span class="no">corr_dist</span>[<span class="no">dist_mat</span> <span class="kw">&gt;</span> <span class="no">given_range</span>] <span class="kw">=</span> <span class="fl">0</span>
  <span class="no">corr_dist</span>[<span class="no">dist_mat</span> <span class="kw">&lt;=</span> <span class="no">given_range</span>] <span class="kw">=</span> <span class="fl">1</span>
  <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="no">corr_dist</span>) <span class="kw">=</span> <span class="fl">0</span>

  <span class="co"># Across sites</span>
  <span class="co"># given_pres is a vector of presences per site</span>
  <span class="no">di_mat</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">abund_mat</span>, <span class="fl">1</span>, <span class="kw">function</span>(<span class="no">given_ab</span>) {
    <span class="no">index_mat</span> <span class="kw">=</span> <span class="no">given_ab</span> <span class="kw">%*%</span> (<span class="no">dist_mat</span> * <span class="no">corr_dist</span>)  <span class="co"># Sum of distances per species</span>
    <span class="no">denom_mat</span> <span class="kw">=</span> <span class="no">given_ab</span> <span class="kw">%*%</span> <span class="no">corr_dist</span>  <span class="co"># Number of distances considered per species</span>
    <span class="no">index_mat</span> <span class="kw">=</span> (<span class="no">index_mat</span> / <span class="no">denom_mat</span>) * (<span class="fl">1</span> - <span class="no">denom_mat</span>)
    <span class="no">index_mat</span>[<span class="no">given_ab</span> <span class="kw">==</span> <span class="fl">0</span> <span class="kw">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">given_ab</span>)] <span class="kw">=</span> <span class="fl">NA</span>
    <span class="no">index_mat</span>[<span class="fu"><a href="https://rdrr.io/r/base/is.finite.html">is.nan</a></span>(<span class="no">index_mat</span>)] <span class="kw">=</span> <span class="fl">1</span>

    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">index_mat</span>)
  })

  <span class="no">di_mat</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">di_mat</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(<span class="no">di_mat</span>) <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(<span class="no">abund_mat</span>)

  <span class="no">di_df</span> <span class="kw">=</span> <span class="kw pkg">funrar</span><span class="kw ns">::</span><span class="fu"><a href="../reference/matrix_to_stack.html">matrix_to_stack</a></span>(<span class="no">di_mat</span>, <span class="st">"Di"</span>)
  <span class="no">di_df</span>$<span class="no">given_range</span> <span class="kw">=</span> <span class="no">given_range</span>

  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">di_df</span>)
}</pre></body></html></div>
<p>Which gives the following results for or situation:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">ab_di_all_ranges</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">1.5</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">50</span>),
       <span class="kw">function</span>(<span class="no">given_number</span>) <span class="fu">alternative_distinctiveness_abundance</span>(<span class="no">ab_mat</span>,
                                                          <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">species_distance</span>),
                                                          <span class="no">given_number</span>))

<span class="no">ab_di_all_ranges</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="no">rbind.data.frame</span>, <span class="no">ab_di_all_ranges</span>)

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">ab_di_all_ranges</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">given_range</span>, <span class="no">Di</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">species</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~<span class="no">site</span>, <span class="kw">labeller</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/as_labeller.html">as_labeller</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">s1</span> <span class="kw">=</span> <span class="st">"s1 (1/3 rel. abund each)"</span>,
                                             <span class="kw">s2</span> <span class="kw">=</span> <span class="st">"s2 (a=1/6, b=1/6, c=4/6)"</span>,
                                             <span class="kw">s3</span> <span class="kw">=</span> <span class="st">"s3 (a=4/6, b=1/6, c=1/6)"</span>))) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Considered Range"</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Functional Distinctiveness"</span>)</pre></body></html></div>
<p><img src="new_distinctiveness_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>We clearly see the difference between s2 and s3 comparing species b and c. In s3, when c has the same relative abundance as b, both species share the same distinctiveness until the range equals 1 (distance between A &amp; B).</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matthias Grenié, Pierre Denelle, Caroline Tucker.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
